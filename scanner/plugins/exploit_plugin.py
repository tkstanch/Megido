"""
ExploitPlugin Base Interface

This module defines the base interface that all exploit plugins must implement.
Each plugin provides exploit capabilities for a specific vulnerability type.
"""

from abc import ABC, abstractmethod
from typing import Dict, List, Any, Optional


class ExploitPlugin(ABC):
    """
    Base interface for exploit plugins.
    
    All exploit plugins must inherit from this class and implement the required methods.
    This allows for a modular, extensible system where new exploits can be added
    simply by dropping a new plugin into the plugins/exploits/ directory.
    
    Attributes:
        vulnerability_type (str): The type of vulnerability this plugin targets
                                 (e.g., 'sqli', 'xss', 'rce', etc.)
        name (str): Human-readable name of the exploit plugin
        description (str): Brief description of what the plugin does
        version (str): Plugin version string
    """
    
    def __init__(self):
        """Initialize the exploit plugin."""
        pass
    
    @property
    @abstractmethod
    def vulnerability_type(self) -> str:
        """
        Return the vulnerability type this plugin handles.
        
        Returns:
            str: Vulnerability type identifier (e.g., 'sqli', 'xss', 'rce')
        """
        pass
    
    @property
    @abstractmethod
    def name(self) -> str:
        """
        Return the human-readable name of this plugin.
        
        Returns:
            str: Plugin name
        """
        pass
    
    @property
    @abstractmethod
    def description(self) -> str:
        """
        Return a brief description of this plugin.
        
        Returns:
            str: Plugin description
        """
        pass
    
    @property
    def version(self) -> str:
        """
        Return the version of this plugin.
        
        Returns:
            str: Version string (default: '1.0.0')
        """
        return '1.0.0'
    
    @abstractmethod
    def generate_payloads(self, context: Optional[Dict[str, Any]] = None) -> List[str]:
        """
        Generate exploit payloads for this vulnerability type.
        
        Args:
            context: Optional dictionary containing context information such as:
                    - target_url: Target URL
                    - parameter: Vulnerable parameter name
                    - database_type: Database type (for SQL injection)
                    - custom settings: Any other relevant context
        
        Returns:
            List[str]: List of payload strings to test
        """
        pass
    
    @abstractmethod
    def execute_attack(self, target_url: str, vulnerability_data: Dict[str, Any],
                      config: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        Execute the exploit attack against a target.
        
        Args:
            target_url: The target URL to attack
            vulnerability_data: Dictionary containing vulnerability information:
                              - parameter: Vulnerable parameter name
                              - method: HTTP method (GET, POST, etc.)
                              - Any other relevant vulnerability data
            config: Optional configuration dictionary for the attack:
                   - timeout: Request timeout
                   - verify_ssl: Whether to verify SSL certificates
                   - custom headers: HTTP headers to use
                   - Any other plugin-specific configuration
        
        Returns:
            Dict[str, Any]: Attack results containing:
                           - success: bool indicating if attack succeeded
                           - data: Any extracted data
                           - evidence: Evidence of successful exploitation
                           - error: Error message if attack failed
        """
        pass
    
    def get_remediation_advice(self) -> str:
        """
        Return remediation advice for this vulnerability type.
        
        Returns:
            str: Remediation guidance
        """
        return "Implement proper input validation and output encoding."
    
    def get_severity_level(self) -> str:
        """
        Return the typical severity level for this vulnerability type.
        
        Returns:
            str: Severity level ('low', 'medium', 'high', 'critical')
        """
        return 'medium'
    
    def validate_config(self, config: Dict[str, Any]) -> bool:
        """
        Validate the configuration for this plugin.
        
        Args:
            config: Configuration dictionary to validate
        
        Returns:
            bool: True if configuration is valid, False otherwise
        """
        return True
    
    def get_required_config_keys(self) -> List[str]:
        """
        Return list of required configuration keys for this plugin.
        
        Returns:
            List[str]: List of required configuration key names
        """
        return []
