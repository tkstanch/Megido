{% extends 'base.html' %}
{% load static %}

{% block title %}Decompiler - Browser Extension Analysis{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">
    <!-- Breadcrumb -->
    <nav class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400">
        <a href="/" class="hover:text-primary-600 dark:hover:text-primary-400">Megido Security</a>
        <span>/</span>
        <span class="text-gray-900 dark:text-white font-medium">Decompiler</span>
        <span>/</span>
        <span class="text-gray-900 dark:text-white font-medium">Home</span>
    </nav>

    <!-- Hero Section -->
    <div class="card bg-gradient-to-br from-primary-500 to-primary-600 text-white">
        <div class="card-body text-center">
            <h1 class="text-3xl font-bold mb-2">{{ title }}</h1>
            <p class="text-primary-100">{{ description }}</p>
        </div>
    </div>

    <!-- Development Notice -->
    <div class="card border-l-4 border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20">
        <div class="card-body">
            <h3 class="text-xl font-semibold text-yellow-800 dark:text-yellow-200 mb-3">⚠️ Development Notice</h3>
            <p class="text-yellow-700 dark:text-yellow-300">
                This app is currently in development. The functionality is scaffolded with stub implementations and detailed documentation. 
                All features are marked with TODOs for future implementation.
            </p>
        </div>
    </div>

    <!-- Key Features -->
    <div class="card">
        <div class="card-header">
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Key Features</h2>
        </div>
        <div class="card-body">
            <ul class="space-y-3">
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Upload and capture browser extension packages (Java applets, Flash SWF, Silverlight XAP)</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Decompile bytecode to source code using appropriate tools</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Detect and defeat obfuscation techniques</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Analyze decompiled code for security vulnerabilities and API usage</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Intercept and analyze browser extension traffic</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Recompile and execute modified code</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Inject JavaScript hooks for extension manipulation</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Programmatically interact with target web applications</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- Supported Extension Types -->
    <div class="card">
        <div class="card-header">
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Supported Extension Types</h2>
        </div>
        <div class="card-body">
            <ul class="space-y-3">
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Java Applets:</strong> .jar and .class files (Decompilers: JAD, CFR, Procyon, Krakatau)
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Flash/ActionScript:</strong> .swf files (Decompiler: JPEXS Free Flash Decompiler)
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Silverlight:</strong> .xap packages (Decompilers: ILSpy, dotPeek)
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">JavaScript:</strong> Browser extensions and scripts
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Workflow Steps -->
    <div class="card">
        <div class="card-header">
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Workflow Steps</h2>
        </div>
        <div class="card-body">
            <ul class="space-y-3">
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 1:</strong> Download or capture the browser extension bytecode/package
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 2:</strong> Detect extension type and select appropriate decompiler
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 3:</strong> Decompile bytecode to source code
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 4:</strong> Detect obfuscation techniques and attempt deobfuscation
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 5:</strong> Analyze source code for APIs, vulnerabilities, and data flows
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 6:</strong> Identify JavaScript injection points
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 7:</strong> Optionally modify and recompile source code
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Step 8:</strong> Execute in browser or standalone environment
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Traffic Interception -->
    <div class="card">
        <div class="card-header">
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Traffic Interception</h2>
        </div>
        <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 font-semibold mb-4">Obstacles and Solutions:</p>
            <ul class="space-y-3">
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">HTTPS Encryption:</strong> Use proxy tools like mitmproxy with SSL interception
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Certificate Pinning:</strong> Bypass using Frida or modify extension code
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">WebSocket Traffic:</strong> Protocol-aware interception required
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Custom/Binary Protocols:</strong> Implement parsers for AMF, Java serialization, etc.
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        <strong class="font-semibold">Anti-debugging:</strong> Defeat using code analysis and modification
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- API Endpoints -->
    <div class="card">
        <div class="card-header">
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">API Endpoints</h2>
        </div>
        <div class="card-body">
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                The following endpoints are available (all return 501 Not Implemented in the current stub version):
            </p>
            <ul class="space-y-2 font-mono text-sm">
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">POST /decompiler/packages/upload/</code> - Upload extension package
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">GET /decompiler/packages/</code> - List extension packages
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">POST /decompiler/jobs/start/</code> - Start decompilation job
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">GET /decompiler/jobs/&lt;job_id&gt;/status/</code> - Get job status
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">POST /decompiler/analyze/</code> - Analyze decompiled code
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">POST /decompiler/obfuscation/detect/</code> - Detect obfuscation
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">POST /decompiler/hooks/inject/</code> - Inject JavaScript hook
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">GET /decompiler/traffic/</code> - List intercepted traffic
                </li>
                <li class="p-3 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700">
                    <code class="text-primary-600 dark:text-primary-400">POST /decompiler/interact/</code> - Interact with web app
                </li>
            </ul>
        </div>
    </div>

    <!-- Next Steps -->
    <div class="card">
        <div class="card-header">
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Next Steps for Developers</h2>
        </div>
        <div class="card-body">
            <ul class="space-y-3">
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        Implement decompiler tool integration in <code class="px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-sm">engine.py</code>
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <div class="text-gray-700 dark:text-gray-300">
                        Add actual file upload handling in <code class="px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-sm">views.py</code>
                    </div>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Implement obfuscation detection algorithms</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Create static analysis engine for code analysis</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Integrate traffic interception with proxy tools</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Implement recompilation pipelines for each extension type</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Add frontend UI for visualizing analysis results</span>
                </li>
                <li class="flex items-start gap-3 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                    <span class="text-primary-600 dark:text-primary-400 font-bold text-lg">▸</span>
                    <span class="text-gray-700 dark:text-gray-300">Write comprehensive tests for all functionality</span>
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
