{% extends 'base.html' %}

{% block title %}{{ result.vulnerability_type }} Exploit - Megido Security{% endblock %}

{% block breadcrumb %}
<li class="text-gray-500 dark:text-gray-400">Megido Security</li>
<li class="text-gray-400 dark:text-gray-500 mx-2">/</li>
<li><a href="{% url 'manipulator:campaign_list' %}" class="text-blue-600 dark:text-blue-400 hover:underline">Campaigns</a></li>
<li class="text-gray-400 dark:text-gray-500 mx-2">/</li>
<li><a href="{% url 'manipulator:campaign_detail' result.campaign.id %}" class="text-blue-600 dark:text-blue-400 hover:underline">{{ result.campaign.name }}</a></li>
<li class="text-gray-400 dark:text-gray-500 mx-2">/</li>
<li class="text-gray-900 dark:text-white font-medium">Exploit #{{ result.id }}</li>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex items-start justify-between">
        <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                <span class="text-red-500">ğŸ’¥</span> {{ result.vulnerability_type }}
            </h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                Detected at {{ result.tested_at|date:"Y-m-d H:i:s" }} &bull;
                Confidence: {{ result.confidence|floatformat:0 }}% &bull;
                Method: {{ result.detection_method }}
            </p>
        </div>
        <span class="text-sm px-3 py-1 rounded-full font-semibold
            {% if result.severity == 'critical' %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200
            {% elif result.severity == 'high' %}bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200
            {% elif result.severity == 'medium' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200
            {% else %}bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400{% endif %}">
            {{ result.severity|upper }}
        </span>
    </div>

    <!-- Injection Point -->
    <div class="card">
        <div class="card-header"><h3 class="card-title">ğŸ¯ Injection Point</h3></div>
        <div class="card-body">
            <dl class="grid grid-cols-2 gap-3 text-sm">
                <div>
                    <dt class="text-gray-500 dark:text-gray-400">URL</dt>
                    <dd class="font-mono text-gray-900 dark:text-white break-all">{{ result.injection_point.url }}</dd>
                </div>
                <div>
                    <dt class="text-gray-500 dark:text-gray-400">Parameter</dt>
                    <dd class="font-mono font-semibold text-gray-900 dark:text-white">{{ result.injection_point.parameter_name }}</dd>
                </div>
                <div>
                    <dt class="text-gray-500 dark:text-gray-400">Type</dt>
                    <dd class="text-gray-900 dark:text-white">{{ result.injection_point.parameter_type }}</dd>
                </div>
                <div>
                    <dt class="text-gray-500 dark:text-gray-400">Location</dt>
                    <dd class="text-gray-900 dark:text-white">{{ result.injection_point.injection_location }}</dd>
                </div>
            </dl>
        </div>
    </div>

    <!-- Payload & Evidence -->
    <div class="card">
        <div class="card-header"><h3 class="card-title">ğŸ”« Payload & Evidence</h3></div>
        <div class="card-body space-y-4">
            <div>
                <label class="label">Payload Used</label>
                <pre class="bg-gray-900 text-green-400 p-3 rounded text-sm overflow-x-auto">{{ result.payload_text }}</pre>
            </div>
            <div>
                <label class="label">Evidence</label>
                <pre class="bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100 p-3 rounded text-sm overflow-x-auto">{{ result.evidence }}</pre>
            </div>
            <div class="grid grid-cols-3 gap-3 text-sm">
                <div>
                    <span class="text-gray-500 dark:text-gray-400">Status Code</span>
                    <p class="font-semibold text-gray-900 dark:text-white">{{ result.response_status|default:"â€”" }}</p>
                </div>
                <div>
                    <span class="text-gray-500 dark:text-gray-400">Response Time</span>
                    <p class="font-semibold text-gray-900 dark:text-white">{{ result.response_time_ms|default:"â€”" }}ms</p>
                </div>
                <div>
                    <span class="text-gray-500 dark:text-gray-400">Method</span>
                    <p class="font-semibold text-gray-900 dark:text-white">{{ result.request_method }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- curl PoC -->
    {% if result.poc_curl_command %}
    <div class="card">
        <div class="card-header"><h3 class="card-title">ğŸ”§ curl Reproduction</h3></div>
        <div class="card-body">
            <pre class="bg-gray-900 text-green-400 p-4 rounded text-sm overflow-x-auto">{{ result.poc_curl_command }}</pre>
        </div>
    </div>
    {% endif %}

    <!-- Python PoC -->
    {% if result.poc_python_script %}
    <div class="card">
        <div class="card-header"><h3 class="card-title">ğŸ Python PoC Script</h3></div>
        <div class="card-body">
            <pre class="bg-gray-900 text-green-400 p-4 rounded text-sm overflow-x-auto">{{ result.poc_python_script }}</pre>
        </div>
    </div>
    {% endif %}

    <!-- Full Report -->
    {% if result.poc_report %}
    <div class="card">
        <div class="card-header"><h3 class="card-title">ğŸ“„ Vulnerability Report</h3></div>
        <div class="card-body">
            <pre class="bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100 p-4 rounded text-sm overflow-x-auto whitespace-pre-wrap">{{ result.poc_report }}</pre>
        </div>
    </div>
    {% endif %}

    <div class="flex gap-3">
        <a href="{% url 'manipulator:campaign_exploits' result.campaign.id %}" class="btn btn-secondary">â† Back to Exploits</a>
        <a href="{% url 'manipulator:campaign_detail' result.campaign.id %}" class="btn btn-secondary">Dashboard</a>
    </div>
</div>
{% endblock %}
