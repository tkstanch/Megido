{% extends "base.html" %}
{% load static %}

{% block title %}Generate Report - Malware Analyser{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Breadcrumb -->
    <nav class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400">
        <a href="/" class="hover:text-primary-600 dark:hover:text-primary-400">Megido Security</a>
        <span>/</span>
        <a href="{% url 'malware_analyser:dashboard' %}" class="hover:text-primary-600 dark:hover:text-primary-400">Malware Analyser</a>
        <span>/</span>
        <a href="{% url 'malware_analyser:scan_results' scan.scan_id %}" class="hover:text-primary-600 dark:hover:text-primary-400">Scan Results</a>
        <span>/</span>
        <span class="text-gray-900 dark:text-white font-medium">Generate Report</span>
    </nav>

    <!-- Header -->
    <div class="card">
        <div class="card-body text-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">üìä Generate Analysis Report</h1>
            <p class="text-gray-600 dark:text-gray-400">Create comprehensive analysis report for {{ scan.file.original_filename }}</p>
        </div>
    </div>

    <!-- Report Summary -->
    <div class="card">
        <div class="card-header">
            <h5>üìã Report Summary</h5>
        </div>
        <div class="card-body">
            <div class="space-y-3">
                <div class="flex justify-between items-center pb-2 border-b border-gray-200 dark:border-gray-700">
                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">File Name:</span>
                    <span class="text-sm text-gray-600 dark:text-gray-400">{{ scan.file.original_filename }}</span>
                </div>
                <div class="flex justify-between items-center pb-2 border-b border-gray-200 dark:border-gray-700">
                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Scan Date:</span>
                    <span class="text-sm text-gray-600 dark:text-gray-400">{{ scan.started_at|date:"Y-m-d H:i:s" }}</span>
                </div>
                <div class="flex justify-between items-center pb-2 border-b border-gray-200 dark:border-gray-700">
                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Threat Status:</span>
                    <span class="badge {% if scan.is_malicious %}badge-error{% else %}badge-success{% endif %}">
                        {% if scan.is_malicious %}Malicious{% else %}Clean{% endif %}
                    </span>
                </div>
                <div class="flex justify-between items-center pb-2 border-b border-gray-200 dark:border-gray-700">
                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Threat Level:</span>
                    <span class="badge 
                        {% if scan.threat_level == 'critical' %}badge-error
                        {% elif scan.threat_level == 'high' %}badge-warning
                        {% elif scan.threat_level == 'medium' %}badge-info
                        {% else %}badge-secondary{% endif %}">
                        {{ scan.get_threat_level_display }}
                    </span>
                </div>
                {% if scan.detected_malware %}
                <div class="flex justify-between items-center pb-2 border-b border-gray-200 dark:border-gray-700">
                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Detected Malware:</span>
                    <span class="text-sm text-red-600 dark:text-red-400 font-semibold">{{ scan.detected_malware }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Analysis Coverage -->
    <div class="card">
        <div class="card-header">
            <h5>üî¨ Analysis Coverage</h5>
        </div>
        <div class="card-body">
            <div class="grid gap-3 md:grid-cols-2">
                <div class="flex items-center space-x-2">
                    {% if scan.static_analysis %}
                    <span class="text-green-500">‚úì</span>
                    <span class="text-sm text-gray-700 dark:text-gray-300">Static Analysis Completed</span>
                    {% else %}
                    <span class="text-gray-400">‚óã</span>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Static Analysis Not Run</span>
                    {% endif %}
                </div>
                <div class="flex items-center space-x-2">
                    {% if scan.dynamic_analysis %}
                    <span class="text-green-500">‚úì</span>
                    <span class="text-sm text-gray-700 dark:text-gray-300">Dynamic Analysis Completed</span>
                    {% else %}
                    <span class="text-gray-400">‚óã</span>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Dynamic Analysis Not Run</span>
                    {% endif %}
                </div>
            </div>
            
            {% if not scan.static_analysis or not scan.dynamic_analysis %}
            <div class="mt-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded p-3">
                <p class="text-sm text-blue-800 dark:text-blue-200">
                    üí° <strong>Tip:</strong> For a more comprehensive report, consider running both 
                    <a href="{% url 'malware_analyser:static_analysis' scan.scan_id %}" class="underline">static analysis</a> and 
                    <a href="{% url 'malware_analyser:dynamic_analysis' scan.scan_id %}" class="underline">dynamic analysis</a> 
                    before generating the report.
                </p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Report Format Selection -->
    <div class="card">
        <div class="card-header">
            <h5>üìÑ Select Report Format</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="space-y-4">
                    <!-- JSON Format -->
                    <label class="flex items-start space-x-3 p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-primary-500 cursor-pointer transition-colors">
                        <input type="radio" name="format" value="json" checked class="mt-1">
                        <div class="flex-1">
                            <p class="font-semibold text-gray-900 dark:text-white">JSON Format</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                Machine-readable format, ideal for integration with other tools and automated processing.
                            </p>
                            <div class="mt-2 flex flex-wrap gap-2">
                                <span class="badge badge-primary text-xs">API Integration</span>
                                <span class="badge badge-primary text-xs">Automation</span>
                                <span class="badge badge-success text-xs">Available Now</span>
                            </div>
                        </div>
                    </label>

                    <!-- HTML Format -->
                    <label class="flex items-start space-x-3 p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-primary-500 cursor-pointer transition-colors opacity-50">
                        <input type="radio" name="format" value="html" disabled class="mt-1">
                        <div class="flex-1">
                            <p class="font-semibold text-gray-900 dark:text-white">HTML Format</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                Web-friendly format with rich formatting, ideal for sharing and presentation.
                            </p>
                            <div class="mt-2 flex flex-wrap gap-2">
                                <span class="badge badge-secondary text-xs">Coming Soon</span>
                            </div>
                        </div>
                    </label>

                    <!-- PDF Format -->
                    <label class="flex items-start space-x-3 p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-primary-500 cursor-pointer transition-colors opacity-50">
                        <input type="radio" name="format" value="pdf" disabled class="mt-1">
                        <div class="flex-1">
                            <p class="font-semibold text-gray-900 dark:text-white">PDF Format</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                Professional document format, ideal for official reports and archiving.
                            </p>
                            <div class="mt-2 flex flex-wrap gap-2">
                                <span class="badge badge-secondary text-xs">Coming Soon</span>
                            </div>
                        </div>
                    </label>
                </div>

                <!-- Submit Button -->
                <div class="mt-6 flex justify-center space-x-3">
                    <a href="{% url 'malware_analyser:scan_results' scan.scan_id %}" class="btn btn-secondary">
                        ‚Üê Cancel
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg">
                        üìä Generate Report
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Report Content Preview -->
    <div class="card">
        <div class="card-header">
            <h5>üëÅÔ∏è Report Will Include</h5>
        </div>
        <div class="card-body">
            <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>Executive summary with key findings</span>
                </li>
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>File identification and hashes</span>
                </li>
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>Threat assessment and classification</span>
                </li>
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>Indicators of Compromise (IOCs)</span>
                </li>
                {% if scan.static_analysis %}
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>Static analysis results (hashes, strings, entropy)</span>
                </li>
                {% endif %}
                {% if scan.dynamic_analysis %}
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>Dynamic analysis results (behavior, network, processes)</span>
                </li>
                {% endif %}
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>Recommendations for remediation</span>
                </li>
                <li class="flex items-center space-x-2">
                    <span class="text-primary-500">‚úì</span>
                    <span>Analysis metadata and timeline</span>
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
