{% extends "base.html" %}
{% load static %}

{% block title %}Malware Analyser - Dashboard{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">
    <!-- Breadcrumb -->
    <nav class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400">
        <a href="/" class="hover:text-primary-600 dark:hover:text-primary-400">Megido Security</a>
        <span>/</span>
        <span class="text-gray-900 dark:text-white font-medium">Malware Analyser</span>
        <span>/</span>
        <span class="text-gray-900 dark:text-white font-medium">Dashboard</span>
    </nav>

    <!-- Hero Section -->
    <div class="card">
        <div class="card-body text-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">üõ°Ô∏è Malware Analyser Dashboard</h1>
            <p class="text-gray-600 dark:text-gray-400">Real-time malware detection and analysis platform</p>
        </div>
    </div>
    
    <!-- Safety Warning Banner -->
    <div class="alert alert-danger">
        <h5 class="font-bold text-lg mb-2">‚ö†Ô∏è CRITICAL SAFETY AND LEGAL WARNINGS ‚ö†Ô∏è</h5>
        <p class="mb-2">
            <strong>EDUCATIONAL USE ONLY:</strong> This malware analyzer integrates with ClamAV for REAL malware detection.
            This is for educational and demonstration purposes only.
        </p>
        <ul class="list-disc list-inside space-y-1">
            <li><strong>NEVER</strong> use for production malware analysis or with real malicious files outside secure sandboxes</li>
            <li><strong>ALWAYS</strong> use in isolated, controlled, authorized testing environments only</li>
            <li><strong>LEGAL:</strong> Ensure compliance with all applicable laws and regulations</li>
            <li><strong>NO LIABILITY:</strong> Users are solely responsible for their use of this tool</li>
        </ul>
    </div>
    
    <!-- Statistics Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="card bg-gradient-to-br from-primary-500 to-primary-600 text-white">
            <div class="card-body text-center">
                <div class="text-3xl mb-2">üì§</div>
                <div class="text-sm opacity-90">Total Uploads</div>
                <div class="text-2xl font-bold">{{ total_uploads }}</div>
            </div>
        </div>
        <div class="card bg-gradient-to-br from-blue-500 to-blue-600 text-white">
            <div class="card-body text-center">
                <div class="text-3xl mb-2">üîç</div>
                <div class="text-sm opacity-90">Total Scans</div>
                <div class="text-2xl font-bold">{{ total_scans }}</div>
            </div>
        </div>
        <div class="card bg-gradient-to-br from-green-500 to-green-600 text-white">
            <div class="card-body text-center">
                <div class="text-3xl mb-2">‚úÖ</div>
                <div class="text-sm opacity-90">Clean Files</div>
                <div class="text-2xl font-bold">{{ clean_files }}</div>
            </div>
        </div>
        <div class="card bg-gradient-to-br from-red-500 to-red-600 text-white">
            <div class="card-body text-center">
                <div class="text-3xl mb-2">‚ö†Ô∏è</div>
                <div class="text-sm opacity-90">Infected Files</div>
                <div class="text-2xl font-bold">{{ infected_files }}</div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="card">
        <div class="card-header">
            <h5>Quick Actions</h5>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <a href="{% url 'malware_analyser:upload_file' %}" class="btn btn-primary">
                    üì§ Upload & Scan
                </a>
                <a href="{% url 'malware_analyser:analysis_goals' %}" class="btn btn-secondary">
                    üéØ Analysis Goals
                </a>
                <a href="{% url 'malware_analyser:analysis_techniques' %}" class="btn btn-secondary">
                    üî¨ Techniques Guide
                </a>
                <a href="{% url 'malware_analyser:best_practices' %}" class="btn bg-orange-500 hover:bg-orange-600 text-white">
                    üõ°Ô∏è Best Practices
                </a>
                {% if user.is_staff %}
                <a href="{% url 'malware_analyser:manage_signatures' %}" class="btn btn-secondary">
                    üìÑ Signatures
                </a>
                <a href="{% url 'malware_analyser:create_test_malware' %}" class="btn bg-yellow-500 hover:bg-yellow-600 text-white">
                    ‚ö†Ô∏è Test Artifacts
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Recent Uploads and Scans -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent Uploads -->
        <div class="card">
            <div class="card-header">
                <h5>Recent Uploads</h5>
            </div>
            <div class="card-body">
                {% if recent_uploads %}
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Filename</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Uploaded</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
                            {% for upload in recent_uploads %}
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100">{{ upload.original_filename|truncatechars:30 }}</td>
                                <td class="px-4 py-3 text-sm">
                                    {% if upload.scan_status == 'clean' %}
                                    <span class="badge badge-success">{{ upload.scan_status }}</span>
                                    {% elif upload.scan_status == 'infected' %}
                                    <span class="badge badge-danger">{{ upload.scan_status }}</span>
                                    {% else %}
                                    <span class="badge badge-warning">{{ upload.scan_status }}</span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-400">{{ upload.uploaded_at|timesince }} ago</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-gray-500 dark:text-gray-400">No uploads yet.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Recent Scans -->
        <div class="card">
            <div class="card-header">
                <h5>Recent Scans</h5>
            </div>
            <div class="card-body">
                {% if recent_scans %}
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">File</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Type</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Result</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
                            {% for scan in recent_scans %}
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100">{{ scan.file.original_filename|truncatechars:25 }}</td>
                                <td class="px-4 py-3 text-sm text-gray-600 dark:text-gray-400">{{ scan.get_scan_type_display }}</td>
                                <td class="px-4 py-3 text-sm">
                                    {% if scan.is_malicious %}
                                    <span class="badge badge-danger">Malicious</span>
                                    {% else %}
                                    <span class="badge badge-success">Clean</span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-3 text-sm">
                                    <a href="{% url 'malware_analyser:scan_results' scan.scan_id %}" class="btn btn-primary btn-sm">View</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-gray-500 dark:text-gray-400">No scans yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
